# 3D gesture recognition technology based on capacitive touch detection `静电电容式3D手势识别`
- 瑞萨电子的静电电容式触摸检测技术，3D手势识别的基本原理以及抗干扰技术。
## 基本原理
> 通过捕捉人体与电极之间静电电容(1pF以下)的微弱变化，判断开关状态。

利用开关电容滤波器(SCF)将静电电容量转换为电流量，对该信号进行放大和数字化处理。能够同时判断开关的状态以及人体对于电极的3D空间坐标。

## 静电电容式3D坐标计算原理
+ 互容式静电电容式触摸检测

互电容方式基本结构包括 `接收电极` `发送电极` `脉冲发生器`。

发送电极输出脉冲时，和接收电极间产生**电磁场耦合**。如果人体接近，一部分电磁场将耦合到人体，导致电极之间的电磁场耦合减少。
通过测量接收电极上电磁场耦合的减少，可以判断人体的接近。

<P align=center>
 <img src="https://cdn.jsdelivr.net/gh/AppleisTasty/Materials/0x0_pic1.svg" width="580">
</p>

### 检测面板
+ 互容式电极面板
由 `4个发送电极` 和 `1个接收电极` 组成

手的3D坐标定义如图

<P align=center>
 <img src="https://cdn.jsdelivr.net/gh/AppleisTasty/Materials/0x0_pic2.svg" width="580">
</p>

上下左右4对电极的电容计数值在没有任何物体接近的状态下是一个稳定的计数值（参考值）。当手接近或离开面板时，电极的计数值会产生变化。

利用计数值相对于参考值的差异程度可以计算3D坐标位置

### XYZ三轴坐标计算方法

+ 设电极计数值和参考值的差值为 `△count`。

+ 设单个电极的 `△count` 的平均值为 `△average`

+ Z坐标计算

由于4个电极在水平和垂直方向上对称分布，如果Z轴位置相同，则四个电极的 `△average` 大致相同。

其中手越接近电极面板 `△average` 越大。Z轴坐标和 `△average` 是分段近似线性关系。

> 事先测量好不同的特定Z轴坐标下的 `△average` 参数作为基准，根据 `△average` 的值就可以计算出当前的Z轴坐标。

**例如**

坐标点（0，0，100），`△average` = 500

坐标点（0，0，150），`△average` = 250

所以如果当前 `△average` = 325，那么Z坐标可以有计算：

z = 100 + (500-325)/((500-50)/(150-100))
  = 135

+ X坐标计算

相同Z轴坐标系啊，沿X轴方向移动手，左右电极的 `△count` 会产生很大差异。定义为 `△horizontal`。

> 手的X坐标为0时， 左右电极的 `△count` 大致相同。手约接近左电极或右电极，`△count`的差异越大。

`△horizontal` 在特定的Z轴坐标下是近似线性的。Z轴坐标越小， `△horizontal`的斜率越大。

所以选择一个特定的Z轴坐标，此时的斜率就是 `△x_slope_REF`。 首先计算的当前Z轴坐标下的 `△horizontal` 的斜率 `△x_slope`。
然后根据当前的 `△x_slope` 和 `△horizontal` 计算X轴坐标。

> Z轴坐标和 `△x_slope` 是分段近似线性关系

**例如**

Z坐标100mm，`△x_slope` = 8

Z坐标150mm，`△x_slope` = 3

那么当Z坐标为135mm时，`△x_slope` 有：

`△x_slope` = 3 + ((150-135)*((8-3)/150-100)) = 4.5

当前 `△horizontal` = 180, X轴坐标 = 180/4.5 = 40

+ Y坐标计算

Y轴坐标的计算过程与X轴坐标同理

## 抗干扰措施

+ 电容触摸传感单元（CTSU）中内置多种噪声抑制电路。
+ 提供用于抑制噪声的软件滤波器。
+ 相应软件中判断噪声超出设定阈值马上停止3D坐标计算，直到噪声恢复正常范围再恢复3D坐标计算。









