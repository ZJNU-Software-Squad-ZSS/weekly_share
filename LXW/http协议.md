# http协议

<img src="https://theskyhouse.oss-cn-hangzhou.aliyuncs.com/alkfjlakwjlfa.png" width="50%"/>

------

[TOC]

------

#### 简介

HTTP协议（超文本传输协议）,用于客户端和服务器之间的通信。请求访问文本或图像等资源的一端称为客户端， 而提供资源响应的一端称为服务器端。

http 1.0特点：

1. 灵活，简单快速
2. 无连接：每次连接只处理一个请求，处理完请求就断开连接，节省传输时间。（当今多数服务器支持长连接，解决了这个问题）
3. 无状态：对于事务处理没有记忆，服务器发送完数据后不会保留连接的有关信息（使用cookie、session，解决了无状态问题）
4. B/S结构（Browser/Server，浏览器/服务器模式）

------

#### URL

提到URL，我们首先得提提URI（统一资源标识符，用来表示唯一的一个资源）web上可用的资源如html文档、图像、视频都是用URI来定位的。

**URI**是以一种抽象的，高层次概念定义统一资源标识，而URL和URN则是具体的资源标识的方式,URL和URN都是一种URI。

**URL，统一资源定位器，是一种具体的URI，不仅标识了资源，还指名如何locate资源。**

一般由以下三个部分组成：

1. 协议、方案（告诉客户端如何访问资源）
2. 主机ip地址（服务器位置）
3. 资源具体地址（目录、文件名）

URL格式：<scheme>://<user>:<password>@<host>:<port>/<path>;<params>?<query>#<frag>
其中最重要的3个部分是：方案（scheme）、主机（host）和路径（path）

------

#### 计算机相互的通信

互联网关键技术---**TCP/IP协议**，两台计算机之间的通信是通过这个协议在因特网上进行的。

IP协议：计算机之间相互识别通信的机制，负责在因特网上发送和接收数据包。仅仅允许计算机相互发消息，并没有检查消息是否损坏或者按次序发送，为了检验消息，在IP协议上设计了传输控制协议TCP。

TCP协议：确保数据包以正确的次序发送到达，确认内容的正确性。它在IP地址之上引端口，允许计算机通过网络提供各种服务（http通信在80端口，电子邮件大多数25端口）

TCP 负责应用软件（比如你的浏览器）和网络软件之间的通信。IP 负责计算机之间的通信。TCP 负责将数据分割并装入 IP 包，IP 负责将包发送至接收者，传输过程要经IP路由器负责根据通信量、网络中的错误或者其他参数来进行正确地寻址，然后在它们到达的时候重新组合它们。

------

#### HTTP工作原理

<1> 浏览器里输入网址，浏览器根据域名解析IP地址

<2> 客户端通过浏览器向http服务端建立TCP连接

<3>客户端向服务端发送http请求

<5> http服务器处理请求并相应：寻找该HTTP文件，如果找到则返回该文件的超文本。http客户端的浏览器对接收到的超文本进行解析，翻译成格式化的页面，显示给用户；

<6>http服务器发送完HTTP内容后，断开HTTP连接；

<7> 双方断开TCP连接

------

#### 请求信息Request

```
GET /562f25980001b1b106000338.jpg HTTP/1.1
Host    img.mukewang.com
User-Agent    Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/51.0.2704.106 Safari/537.36
Accept    image/webp,image/*,*/*;q=0.8
Referer    http://www.imooc.com/
Accept-Encoding    gzip, deflate, sdch
Accept-Language    zh-CN,zh;q=0.8
（此处是空行，用于分隔）
（请求数据）
```

- 第一部分：请求行---用来说明请求方法，访问的资源以及http版本
- 第二部分：请求头部---用于说明服务器要使用的附加信息。里面包含Accept（浏览器或客户可以接受的文件格式，后面Servlet可以根据它来判断返回的文件格式），Host（对应网址URL中的Web名称、端口号），Referer（表明产生请求的网页URL），User-Agent（客户浏览器名称）等等
- 第三部分：空行 这是必须的
- 第四部分：请求数据（数据体，可以添加其他数据）

###### 请求方法

GET：请求参数作为一个键值对附加到URL上

POST：传输数据通过post机制，将键值对封存在请求实体中传送给服务器，对用户不可见。

*请求方法有很多种，这边提下GET和POST的区别*

- GET提交，请求的数据会在地址栏中显示出来，POST提交，地址栏不会改变
- GET传输数据大小受URL长度限制，POST不是通过URL传值，传输数据不受限制
- POST较为安全（GET提交数据，用户名和密码明文出现在URL上，浏览器缓存后容易被他人查询日志）

------

#### 响应消息Response

```
HTTP/1.1 200 OK
Date: Fri, 22 May 2009 06:07:21 GMT
Content-Type: text/html; charset=UTF-8

<html>
      <head></head>
      <body>
            <!--body goes here-->
      </body>
</html>
```

- 第一部分：状态行---HTTP版本+状态码+状态消息
- 第二部分：消息报头---客户端的附加信息
- 第三部分：空行 和请求消息同理
- 第四部分：响应正文，服务器返回给客户端的文本信息

###### 状态码（个别重要）

200 OK 客户端请求成功

301 永久重定向  表示请求的资源已被分配了新的URL，以后应使用资源现在所指的URL

302 临时重定向（参考301）

400 客户端请求有语法错误

401 请求未经授权

403 服务器拒绝提供服务

404 请求资源不存在（输入了错误的URL）

500 服务器发生了未知的错误

503 服务器暂时不能处理客户端请求，一段时间后可恢复正常

------

#### 关于HTTP访问的无连接和无状态性

早期无连接，服务器要处理面向世界成百上千客户端网页的访问，网页的发两次传送数据关联性很低，大部分通道空闲，这就使得资源给占用、浪费。**因此http协议被设计为请求时连接，请求完释放，腾出资源服务其他客户端。**

随着时间推移，网页越来越复杂，每次访问图片或其他信息都要再建立一次TCP连接就显得很低效，Keep-Alive功能使得客户端和服务器端持续有效，保持HTTP连接。



无状态性意味每个请求独立，**优点：解放了服务器，不会造成不必要占用。缺点：每次请求会传输大量重复的功能**，特别是动态交互的应用程序（想想看购物车程序需要知道用户之前选择了什么商品的）这边产生了Cookie和Session两种技术

Cookie可以保持登录信息----下次访问到同一网站时，不必再输入用户名和密码就可以登录（或者购物车，选择的商品写入cookie）

Session通过服务器保持状态，服务器根据需求设置Session，将会话信息保存在服务器上，同时将表示的id传递给客户端浏览器，浏览器保存id到内存中，也可以称为没有过期时间的Cookie。当浏览器关闭，这个Cookie就会被清理，不会存在于Cookie临时文件中。

**以后浏览器每次请求都会额外加上这个参数值，服务器会根据这个 SessionId，就能取得客户端的数据信息**，当然我们可以设置一个 Session 超时时间，一旦超过规定时间没有客户端请求时，服务器就会清除对应 SessionId 的 Session 信息。

------



