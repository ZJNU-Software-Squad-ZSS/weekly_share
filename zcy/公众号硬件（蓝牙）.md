# 公众号硬件（蓝牙）

## 一些资料

1. 一张图读懂微信硬件平台的物联网架构

   ```
   https://www.cnblogs.com/yueqian-scut/p/5328871.html
   ```

2. 一些第三方的打印机（直接可以使用来打印）

   ```
   http://wiki.zhongwuyun.com/818951 (打印机使用文档)
   
   https://blog.csdn.net/u010520850/article/details/83064626 （一些介绍）
   ```

   

## 知识点

### 控制（菜单控制）

>　　1）用户点击微信公众号提供的菜单，如开灯。
>
>　　2）消息通过微信公众平台发送给厂商云后端。
>
>　　3）云后端在自己的数据库内验证微信用户和设备的有效性后，将微信菜单的开灯消息转化为自定义协议的开灯消息（这个协议只有云后端和外设设备所认识），并根据airsync中的protobuf协议对消息体进行打包封装，最后通过调用微信硬件平台提供的API接口主动推送出去。
>
>　　4）微信硬件平台收到信息后通过微信公众平台回传给微信用户所在的公众号。
>
>　　5）微信将这个消息根据airsync协议通过手机蓝牙发送蓝牙外设。
>
>　　6）蓝牙外设收到消息进行相应的处理。
>
>从这个过程来看，直接的菜单控制走的流程太长了，影响效率。下面介绍的JSAPI控制就是直接控制，不需要再通过厂商云来发指令。 

### 控制（H5/JSAPI控制）

> ​      1）用户点击微信公众号提供的H5网页链接
>
> ​      2）微信浏览器通过H5地址向厂商云后端请求响应，返回H5页面。
>
> ​      3）用户点击H5页面的开灯button
>
> ​      4）button通过JSAPI接口直接向蓝牙设备发出自定义的控制消息，JSAPI蓝牙接口已经封装好airsync协议。
>
> ​      5）蓝牙设备收到消息进行相应的处理。

