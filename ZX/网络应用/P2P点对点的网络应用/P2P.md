# P2P

  ## 文件分发：BitTorrent协议

1. tracker：跟踪参与torrent的节点，是一个机器

2. torrent：交换同一文件的文件块的节点组

3. 交换的文件块：chunk，是256k大小的文件块

   ​		节点如何加入torrent：

   * 刚开始没有chunk，但是会逐渐累积

   * 向tracker注册以获得节点清单，与某些节点("邻居")建立连接
   * 在下载的同时，节点需要向其他节点上传chunk
   * 节点可能加入或离开
   * 一旦节点获得完整的文件，它可能离开或留下

4. 怎么获取chunk

   	* 给定任意时刻，不同节点持有文件的不同chunk集合
   	* 节点定期查询每个邻居所持有的chunk列表
   	* 节点发送请求，请求获取缺失的chunk：当只有3个邻居有特定的chunk时，优先下载这三个的chunk

   

5. 怎么发送chunk：tit-for-tat

   1. 向4个邻居发送chunk，对其的要求是：正在给我发送chunk，速度最快的4个，并且每10秒刷新一次最快的4个
   2. 每30秒随机选择一个其他节点，向其发送节点

==总结==：上传速度高的人，能够找到更好的交易伙伴，才能更好地获取文件

# P2P应用的索引技术

​		p2p系统的索引：信息到节点位置（IP地址+端口号）的映射

  * 文件共享：
    1. 利用索引动态跟踪节点所共享的文件的位置
    2. 节点需要告诉索引它拥有哪些文件
    3. 节点搜索索引，从而获知能够得到哪些文件
* 即时消息qq：索引负责把用户名映射到位置。当用户开启IM应用时，需要通知索引它的位置，节点检索索引，确定用户的ip地址

### 集中式索引：

![1573459452161](C:\Users\19788\AppData\Roaming\Typora\typora-user-images\1573459452161.png)

缺点：

		* 单点失效问题：服务器宕机时，就完蛋了
		* 性能瓶颈：服务器处理速度有限
		* 版权问题

### 洪泛式查询

![1573459963202](C:\Users\19788\AppData\Roaming\Typora\typora-user-images\1573459963202.png)

​		缺点：大量的查询，会影响网络性能

### 层次式覆盖网络

大黑点是超级节点，小黑点是普通节点，大小之间用TCP连接

![1573460188805](C:\Users\19788\AppData\Roaming\Typora\typora-user-images\1573460188805.png)

案例应用：Skype

![1573460554595](C:\Users\19788\AppData\Roaming\Typora\typora-user-images\1573460554595.png)

