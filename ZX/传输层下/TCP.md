# TCP

​		序列号：☞segment中第一个字节的编号，建立TCP连接时，双方随机选择序列号

​		ACKs: 希望接收到的下一字节的序列号，

​				累计确认：该序列号之前的所有字节都被接收到才会发送ACK。

​		tcp中不会处理乱序到达的Segment



## tcp可靠数据传输

设置定时器：多测几个RTT，估计出RTT的值。

定时器时间 = 估计值 + 4倍的DevRTT

发送方：

1. 创建Segment，
  2. 序列号是Segment第一个字节
   3. 开启计时器
   4. 设置超时时间

### 流量控制

​	发送方发送数据过快过多，会导致接收方缓存溢出。

​	速度匹配机制

### 连接管理：三次握手、四次挥手

第一步：客户机发送TCP SYN报文段给接收端，初始化seq#，发送报文段中没有数据

第二步：接收方收到SYN，回复SYNACK报文段，然后分配缓存，选择初始序列号seq

第三步：客户机收到SYNACK报文段，发送ACK报文段，SYN不再置一，以及发送的报文已经可以发送数据了。

为什么要三次握手：

```text
三次握手：
“喂，你听得到吗？”
“我听得到呀，你听得到我吗？”
“我能听到你，今天 balabala……”
```

第三次ack丢包：server端会根据TCP超时重传机制发送3秒、6秒、12秒SYNACK，如果次数超过指定次数，那么自动关闭连接

TCP关闭： 

第一步：客户端发送TCP FIN信号

第二步：server端收到FIN，回复ACK。关闭连接，发送FIN。

第三步：客户端收到FIN，回复ACK。但是会加入等待状态：如果收到FIN,会重新发送ACK。

第四步：server收到ACK,连接关闭